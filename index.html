<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ü–æ–¥–±–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Äî –®–ê–ì–ê–ô –î–û–ú–ê</title>
<style>
:root{
  --bg:#ffffff; --paper:#ffffff; --ink:#1f2328; --muted:#6b7280;
  --line:#ececec; --accent:#b22222; --grad1:#ff6d6d; --grad2:#ffb86b;
  --rad:18px; --navH:96px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial,sans-serif;
  background:#fff;
}
.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:18px}
.card{
  width:min(980px,100%);
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:var(--rad);
  box-shadow:0 30px 80px rgba(0,0,0,.06);
  overflow:hidden;
}

/* ---------- –®–∞–ø–∫–∞: –ª–æ–≥–æ—Ç–∏–ø —Å–ª–µ–≤–∞, –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø—Ä–∞–≤–∞ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ ---------- */
.header{
  padding:18px;
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
  column-gap:22px;
}
.brand-img{height:44px;width:auto;display:block}
h1{
  margin:0;
  font-size:26px;
  line-height:1.15;
  max-width:20ch;     /* ~3 —Å—Ç—Ä–æ–∫–∏ */
  text-wrap:balance;
}

/* ---------- –ü—Ä–æ–≥—Ä–µ—Å—Å ---------- */
.progress{padding:0 18px 14px}
.bar{height:10px;border-radius:999px;background:#f2f4f7;position:relative;overflow:hidden;border:1px solid #eef0f3}
.fill{position:absolute;inset:0 100% 0 0;border-radius:999px;
  background:linear-gradient(90deg,var(--grad1),var(--grad2));transition:inset .35s ease}
.pct{margin-top:6px;font-size:12px;color:var(--muted)}

/* ---------- –°—Ü–µ–Ω–∞/—à–∞–≥ ---------- */
.stage{position:relative;padding:16px 18px calc(var(--navH) + 16px);min-height:56vh}
.step{
  position:absolute;inset:0;opacity:0;transform:translateY(8px);transition:.28s;
  display:flex;flex-direction:column;min-height:0;
}
.step.active{opacity:1;transform:none}
.step.out{opacity:0;transform:translateY(-8px)}
.scroll{flex:1;min-height:0;overflow:auto;padding-right:6px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;scrollbar-width:thin;scrollbar-gutter:stable both-edges}

/* ---------- –ö–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞ ---------- */
.q{font-size:26px;line-height:1.2;margin:6px 0 12px}
.sub{color:var(--muted);font-size:14px;margin:0 0 14px}
.illustration{display:block;width:100%;max-height:240px;object-fit:contain;margin:0 0 12px;border-radius:14px;background:#fff;border:1px solid #e9ecf1}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(230px,1fr))}
.opt{display:flex;gap:10px;align-items:center;padding:14px;border:2px dashed #1f4a7f55;border-radius:14px;background:#fffdf8;cursor:pointer;transition:.18s}
.opt:hover{border-color:#1f4a7f88;background:#fff8ef}
.opt.sel{border:2px solid var(--accent);background:#fff1f1}
.opt .ico{font-size:20px;width:26px;text-align:center}
.opt .t{font-size:16px}

/* –∏–Ω–ø—É—Ç—ã */
.inputs{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.input{background:#fff;border:1px solid #e9ecf1;border-radius:12px;padding:12px;display:flex;flex-direction:column}
.input label{font-size:12px;color:var(--muted);margin-bottom:6px}
.input input{background:transparent;border:0;color:var(--ink);font-size:18px;outline:none}

/* ---------- –ù–∞–≤–∏–≥–∞—Ü–∏—è ---------- */
.nav{
  position:sticky;bottom:0;display:flex;gap:12px;justify-content:space-between;align-items:center;
  padding:12px 18px;background:linear-gradient(180deg,rgba(255,255,255,0),#fff 35%,#fff 60%);border-top:1px solid #eef0f3
}
.btn{border:0;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer}
.btn.secondary{background:#f3f4f6;color:#111827;border:1px solid #e5e7eb}
.btn.primary{background:linear-gradient(90deg,var(--grad1),var(--grad2));color:#1a0b0b}
.btn:disabled{opacity:.55;cursor:not-allowed}

/* info/–∏—Ç–æ–≥ */
.center{display:grid;place-content:center;text-align:center;height:100%}
.spinner{width:46px;height:46px;border:4px solid #e9ecf1;border-top-color:#ff8a6b;border-radius:50%;margin:8px auto 12px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.infoText{font-size:24px;text-align:center;margin:6px 0 16px}
.infoText .hl{color:var(--accent);font-weight:900}

.result{padding:22px 18px 26px;text-align:center}
.badge{width:170px;height:170px;margin:8px auto 10px;border-radius:50%;background:radial-gradient(circle at 50% 40%,#ffe6ea,#ff98ac 60%,#ff617d);box-shadow:0 18px 40px rgba(255,77,94,.25);color:#fff;display:grid;place-content:center;font-size:64px}
.plan{font-size:24px;margin:6px 0 8px;color:var(--accent)}
.desc{max-width:720px;margin:0 auto 12px;line-height:1.55}
.buy{display:inline-block;margin-top:10px;padding:14px 24px;border-radius:999px;background:linear-gradient(90deg,var(--grad1),var(--grad2));color:#1a0b0b;text-decoration:none;font-weight:900}
.tools{margin-top:12px;display:flex;gap:10px;justify-content:center}
.tools .btn{font-weight:700}
.note{font-size:12px;color:#6b7280;margin-top:8px}

@media (max-width:520px){
  h1{font-size:22px;max-width:18ch}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="app">
    <div class="header">
      <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="brand-img"/>
      <h1>–ù–∞–π–¥—ë–º –≤–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
    </div>

    <div class="progress">
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="pct" id="pct">0%</div>
    </div>

    <div class="stage" id="stage"></div>

    <div class="nav" id="nav">
      <button class="btn secondary" id="back">–ù–∞–∑–∞–¥</button>
      <button class="btn primary" id="next" disabled>–î–∞–ª–µ–µ</button>
    </div>
  </div>
</div>

<script>
const ANALYTICS_ENDPOINT = ""; // –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π backend

const PLANS = {
  start45:{title:"–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç 45+",icon:"ü´∂",
    desc:"–©–∞–¥—è—â–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –ø—Ä—ã–∂–∫–æ–≤, –º—è–≥–∫–æ–µ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ, –∑–∞–±–æ—Ç–∞ –æ —Å—É—Å—Ç–∞–≤–∞—Ö.",
    buy:"https://walk-walk.ru/checkout?plan=start45"},
  fatburn:{title:"–ñ–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ Light",icon:"üî•",
    desc:"–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∏ —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ –∫–∞—Ä–¥–∏–æ-—Å–≤—è–∑–∫–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞ –≤ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–º —Ç–µ–º–ø–µ.",
    buy:"https://walk-walk.ru/checkout?plan=fatburn"},
  tone:{title:"–¢–æ–Ω—É—Å –∏ –æ—Å–∞–Ω–∫–∞",icon:"üéØ",
    desc:"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã –Ω–∞ —Å–ø–∏–Ω—É –∏ –∫–æ—Ä–ø—É—Å: –ø–æ–¥—Ç—è–Ω—É—Ç–∞—è –æ—Å–∞–Ω–∫–∞ –∏ –∫—Ä–µ–ø–∫–∏–π —Ü–µ–Ω—Ç—Ä.",
    buy:"https://walk-walk.ru/checkout?plan=tone"},
  party:{title:"–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Å–∫–æ—Ç–µ–∫–∏",icon:"üéµ",
    desc:"–ú—É–∑—ã–∫–∞, –ø—Ä–æ—Å—Ç—ã–µ —Ä–∏—Ç–º—ã, –º–Ω–æ–≥–æ —à–∞–≥–æ–≤ ‚Äî —Ö—É–¥–µ–µ–º ¬´–Ω–∞ —Ä–∞–¥–æ—Å—Ç—è—Ö¬ª.",
    buy:"https://walk-walk.ru/checkout?plan=party"},
  mobility:{title:"–ü–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å –∏ —Ä–∞—Å—Ç—è–∂–∫–∞",icon:"üßò‚Äç‚ôÄÔ∏è",
    desc:"–ì–∏–±–∫–æ—Å—Ç—å, —Å—É—Å—Ç–∞–≤–Ω–∞—è –º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ª—é–±–æ–º—É –ø–ª–∞–Ω—É.",
    buy:"https://walk-walk.ru/checkout?plan=mobility"},
  fast20:{title:"–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç 20‚Äì25 –º–∏–Ω—É—Ç",icon:"‚è±Ô∏è",
    desc:"–ö–æ—Ä–æ—Ç–∫–∏–µ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–ª–∏–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.",
    buy:"https://walk-walk.ru/checkout?plan=fast20"}
};

/* ---------- –®–∞–≥–∏ ---------- */
const STEPS = [
  {type:"choice", q:"–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç", image:"age.png",
    options:[
      {t:"18‚Äì29 –ª–µ—Ç", ico:"‚ú®"},
      {t:"30‚Äì39 –ª–µ—Ç", ico:"üåø"},
      {t:"40‚Äì49 –ª–µ—Ç", ico:"üå∏"},
      {t:"50+ –ª–µ—Ç",   ico:"üí´", plan:"start45"}
    ]
  },
  {type:"info", image:"2.jpg",
    text:'–ë–æ–ª—å—à–µ <span class="hl">8000+</span> –∂–µ–Ω—â–∏–Ω —É–∂–µ –∑–∞–Ω–∏–º–∞—é—Ç—Å—è —Å –®–ê–ì–ê–ô –î–û–ú–ê‚ö°'
  },
  {type:"choice", q:"–ö–∞–∫–∞—è —Ç–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å?", image:"3.png", options:[
    {t:"–ü–æ—Ö—É–¥–µ—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ", plan:"fatburn", ico:"üî•"},
    {t:"–ù–∞—á–∞—Ç—å –º—è–≥–∫–æ", plan:"start45", ico:"ü´∂"},
    {t:"–ü–æ–¥—Ç—è–Ω—É—Ç—å —Ç–µ–ª–æ", plan:"tone", ico:"üéØ"},
    {t:"–î–≤–∏–∂–µ–Ω–∏–µ –ø–æ–¥ –º—É–∑—ã–∫—É", plan:"party", ico:"üéµ"},
    {t:"–ì–∏–±–∫–æ—Å—Ç—å –∏ –ª—ë–≥–∫–æ—Å—Ç—å", plan:"mobility", ico:"üßò‚Äç‚ôÄÔ∏è"},
    {t:"–ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è 20‚Äì25 –º–∏–Ω", plan:"fast20", ico:"‚è±Ô∏è"}
  ]},
  /* –Ω–æ–≤—ã–π 4-–π –≤–æ–ø—Ä–æ—Å ‚Äî —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ */
  {type:"choice", q:"–ö–∞–∫–æ–π –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ª—É—á—à–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤–∞—à–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ?", image:"weight.png", options:[
    {t:"–•—É–¥–µ–Ω—å–∫–æ–µ",        plan:"tone",    ico:"ü™∂"},
    {t:"–°—Ä–µ–¥–Ω–µ–µ",          plan:"fatburn", ico:"üôÇ"},
    {t:"–ö—Ä—É–ø–Ω–æ–µ",          plan:"fatburn", ico:"üî•"},
    {t:"–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å",   plan:"fatburn", ico:"üî•üî•"}
  ]},
  {type:"choice", q:"–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:", options:[
    {t:"–ù–æ–≤–∏—á–æ–∫ / –ø–µ—Ä–µ—Ä—ã–≤", plan:"start45", ico:"üå±"},
    {t:"–†–µ–¥–∫–æ –¥–≤–∏–≥–∞—é—Å—å",    plan:"fast20",  ico:"‚åõ"},
    {t:"–°—Ä–µ–¥–Ω–∏–π",           plan:"fatburn", ico:"üôÇ"},
    {t:"–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π, –Ω–æ –±–µ–∑ –ø—Ä—ã–∂–∫–æ–≤", plan:"party", ico:"üé∂"},
    {t:"–ù—É–∂–µ–Ω –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–ø–∏–Ω—É/–∫–æ—Ä–ø—É—Å", plan:"tone", ico:"üéØ"}
  ]},
  {type:"inputs", q:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞",
    sub:"–†–æ—Å—Ç –∏ –≤–µ—Å –ø–æ–º–æ–≥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–µ–µ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ç–µ–º–ø. (–ú–æ–∂–Ω–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)",
    fields:[
      {id:"height",label:"–†–æ—Å—Ç (—Å–º)",min:130,max:220,placeholder:"165"},
      {id:"weight",label:"–í–µ—Å (–∫–≥)",min:35,max:180,placeholder:"70"}
    ]
  },
  {type:"choice", q:"–ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?", options:[
    {t:"–ö–æ–ª–µ–Ω–∏/—Å—É—Å—Ç–∞–≤—ã ‚Äî —â–∞–¥—è—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞", plan:"start45", ico:"ü¶µ"},
    {t:"–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —Å–ø–∏–Ω–∞/—à–µ—è",          plan:"tone",   ico:"üßç‚Äç‚ôÄÔ∏è"},
    {t:"–ù–µ—Ç —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π",         plan:"fatburn",ico:"üí™"},
    {t:"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –Ω–∏–∑–∫—É—é —É–¥–∞—Ä–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É", plan:"mobility", ico:"üßò‚Äç‚ôÄÔ∏è"}
  ]},
  {type:"choice", q:"–ö–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω—Ä–∞–≤—è—Ç—Å—è –±–æ–ª—å—à–µ?", options:[
    {t:"–®–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ/—Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–µ", plan:"party",   ico:"üéµ"},
    {t:"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞ –∫–æ—Ä–ø—É—Å", plan:"tone",    ico:"üéØ"},
    {t:"–ö–∞—Ä–¥–∏–æ + –Ω–µ–º–Ω–æ–≥–æ —Å–∏–ª–æ–≤—ã—Ö", plan:"fatburn", ico:"üî•"},
    {t:"–†–∞—Å—Ç—è–∂–∫–∞ –∏ –¥—ã—Ö–∞–Ω–∏–µ",       plan:"mobility",ico:"üßò‚Äç‚ôÄÔ∏è"},
    {t:"–ö–æ—Ä–æ—Ç–∫–∏–µ —ç–∫—Å–ø—Ä–µ—Å—Å-–∑–∞–Ω—è—Ç–∏—è",plan:"fast20",  ico:"‚è±Ô∏è"},
    {t:"–ú—è–≥–∫–æ 45+",                plan:"start45", ico:"ü´∂"}
  ]},
  {type:"choice", q:"–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:", options:[
    {t:"–ë–µ–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è",        plan:"party",    ico:"üö´"},
    {t:"–¢–æ–ª—å–∫–æ –∫–æ–≤—Ä–∏–∫",        plan:"mobility", ico:"üßò"},
    {t:"–†–µ–∑–∏–Ω–∫–∏/–≥–∞–Ω—Ç–µ–ª–∏ light",plan:"fatburn",  ico:"üèãÔ∏è"},
    {t:"–ú—è—á/—Ä–æ–ª–ª/–ª–µ–Ω—Ç–∞",       plan:"tone",     ico:"üß∂"}
  ]},
  {type:"choice", q:"–¢–µ–º–ø –∑–∞–Ω—è—Ç–∏–π:", options:[
    {t:"–°–ø–æ–∫–æ–π–Ω—ã–π",              plan:"mobility", ico:"ü´ß"},
    {t:"–ú—è–≥–∫–∏–π, –±–µ–∑ –ø—Ä—ã–∂–∫–æ–≤",    plan:"start45",  ico:"ü´∂"},
    {t:"–°—Ä–µ–¥–Ω–∏–π, –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π",    plan:"fatburn",  ico:"üôÇ"},
    {t:"–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π, –Ω–æ –Ω–µ —Å–ª–æ–∂–Ω—ã–π", plan:"party", ico:"üé∂"},
    {t:"–° –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É",  plan:"tone",     ico:"üéØ"}
  ]},
  {type:"loading"}
];

let step=0;
const scores={};
const data={answers:[]};
const sessionId=Date.now().toString(36)+Math.random().toString(36).slice(2,8);

const stage=document.getElementById('stage');
const fill=document.getElementById('fill');
const pct=document.getElementById('pct');
const nextBt=document.getElementById('next');
const backBt=document.getElementById('back');
const navEl=document.getElementById('nav');

function updateNavH(){ const h=(navEl?.offsetHeight||84)+'px'; document.documentElement.style.setProperty('--navH',h);}
window.addEventListener('resize',updateNavH); setTimeout(updateNavH,0);

function setProgress(){
  const total=STEPS.length;
  const p=Math.round((Math.min(step,total-1))/(total-1)*100);
  fill.style.insetInlineEnd=(100-p)+'%';
  pct.textContent=p+'%';
}
function bump(plan,n=1){ if(!plan) return; scores[plan]=(scores[plan]||0)+n; }
function bmiScore(h,w){ if(!h||!w) return; const m=w/Math.pow(h/100,2); if(m>=27)bump('fatburn',2); else if(m>=24)bump('fatburn',1); if(m<22)bump('tone',1);}
function logAnswer(stepIdx,qText,answerText,planKey){
  const rec={step:stepIdx,q:qText,answer:answerText,plan:(planKey||null),ts:new Date().toISOString()};
  const i=data.answers.findIndex(x=>x.step===stepIdx);
  if(i>=0) data.answers[i]=rec; else data.answers.push(rec);
}

function render(){
  setProgress(); updateNavH();
  const prev=stage.querySelector('.step.active');
  if(prev){ prev.classList.remove('active'); prev.classList.add('out'); setTimeout(()=>prev.remove(),260); }
  const cfg=STEPS[step];
  const el=document.createElement('div'); el.className='step'; stage.appendChild(el);
  nextBt.disabled=true; backBt.disabled=(step===0);

  if(cfg.type==='choice'){
    el.innerHTML=`
      ${cfg.image?`<img class="illustration" src="${cfg.image}" alt="">`:''}
      <div class="q">${cfg.q}</div>
      ${cfg.sub?`<div class="sub">${cfg.sub}</div>`:''}
      <div class="scroll"><div class="grid">
        ${cfg.options.map(o=>`
          <button class="opt" data-plan="${o.plan||''}">
            <div class="ico">${o.ico||'‚Ä¢'}</div><div class="t">${o.t}</div>
          </button>`).join('')}
      </div></div>`;
    el.addEventListener('click',(e)=>{
      const btn=e.target.closest('.opt'); if(!btn) return;
      el.querySelectorAll('.opt').forEach(b=>b.classList.remove('sel'));
      btn.classList.add('sel'); nextBt.disabled=false;
      const text=btn.querySelector('.t').textContent.trim(); const p=btn.dataset.plan||null;
      if(p) bump(p,1); logAnswer(step,cfg.q,text,p);
      btn.scrollIntoView({block:'nearest',behavior:'smooth'});
    });
  }

  if(cfg.type==='info'){
    nextBt.disabled=false;
    el.innerHTML=`
      ${cfg.image?`<img class="illustration" src="${cfg.image}" alt="">`:''}
      <div class="infoText">${cfg.text}</div>`;
    logAnswer(step,'–ò–Ω—Ñ–æ-—Å–ª–∞–π–¥','seen',null);
  }

  if(cfg.type==='inputs'){
    el.innerHTML=`
      <div class="q">${cfg.q}</div>
      ${cfg.sub?`<div class="sub">${cfg.sub}</div>`:''}
      <div class="scroll"><div class="inputs">
        ${cfg.fields.map(f=>`
          <div class="input">
            <label for="${f.id}">${f.label}</label>
            <input id="${f.id}" type="number" inputmode="decimal"
              placeholder="${f.placeholder||''}" min="${f.min||''}" max="${f.max||''}"/>
          </div>`).join('')}
      </div></div>`;
    const h=el.querySelector('#height'), w=el.querySelector('#weight');
    const validate=()=>{
      const hv=Number(h?.value||h?.placeholder||0);
      const wv=Number(w?.value||w?.placeholder||0);
      nextBt.disabled=!(hv>=130&&hv<=220&&wv>=35&&wv<=180);
      if(!nextBt.disabled){ data.height=hv; data.weight=wv; }
    };
    el.addEventListener('input',validate); validate();
  }

  if(cfg.type==='loading'){
    el.innerHTML=`<div class="center"><div class="spinner"></div><div class="sub">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã‚Ä¶</div></div>`;
    nextBt.disabled=true; backBt.disabled=true;
    if(data.height&&data.weight) bmiScore(data.height,data.weight);
    setTimeout(showResult,1100);
  }

  requestAnimationFrame(()=>el.classList.add('active'));
}

document.getElementById('next').addEventListener('click',()=>{ step=Math.min(step+1,STEPS.length-1); render(); });
document.getElementById('back').addEventListener('click',()=>{ if(step===0) return; step--; render(); });

/* -------- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏—Ç–æ–≥ -------- */
function toCSVRows(items){
  const rows=[], head=['sessionId','createdAt','bestPlan','height','weight','answersJSON','scoresJSON','userAgent','screenW','screenH'];
  rows.push(head);
  for(const it of items){
    rows.push([
      it.sessionId,it.createdAt,it.derived.bestPlan,it.user.height||'',it.user.weight||'',
      JSON.stringify(it.answers),JSON.stringify(it.derived.scores),
      it.meta.ua,it.meta.w,it.meta.h
    ]);
  }
  return rows.map(r=>r.map(v=>{const s=String(v??'');return /[",\n;]/.test(s)?`"${s.replace(/"/g,'""')}"`:s;}).join(';')).join('\n');
}
function downloadCSV(all){
  const csv=toCSVRows(all);
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8"});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`quiz_export_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click(); a.remove();
}
function sendToEndpoint(payload){
  if(!ANALYTICS_ENDPOINT) return;
  try{ fetch(ANALYTICS_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).catch(()=>{}); }catch(_){}
}
function showResult(){
  let bestKey=Object.keys(PLANS)[0], bestVal=-1;
  for(const k of Object.keys(PLANS)){ const v=scores[k]||0; if(v>bestVal){bestVal=v; bestKey=k;} }
  const plan=PLANS[bestKey];

  const payload={
    sessionId,
    createdAt:new Date().toISOString(),
    answers:data.answers,
    user:{height:data.height||null,weight:data.weight||null},
    derived:{bestPlan:bestKey,scores:{...scores}},
    meta:{ua:navigator.userAgent,w:innerWidth,h:innerHeight}
  };
  const key='quizLogs'; const existing=JSON.parse(localStorage.getItem(key)||'[]'); existing.push(payload); localStorage.setItem(key,JSON.stringify(existing));
  sendToEndpoint(payload);

  const app=document.getElementById('app');
  app.innerHTML=`
    <div class="header">
      <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="brand-img"/>
      <h1>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤!</h1>
    </div>
    <div class="result">
      <div class="badge">${plan.icon||'‚≠ê'}</div>
      <div class="plan">–í–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç: <b>${plan.title}</b></div>
      <p class="desc">${plan.desc}</p>
      <a class="buy" href="${plan.buy}" target="_blank" rel="noopener">–ö—É–ø–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</a>
      <div class="tools">
        <button class="btn secondary" id="again">–ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</button>
        <button class="btn secondary" id="export">–°–∫–∞—á–∞—Ç—å –æ—Ç–≤–µ—Ç—ã (CSV)</button>
      </div>
      <div class="note">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî –≤—ã–≥—Ä—É–∑–∏—Ç–µ CSV –∫–Ω–æ–ø–∫–æ–π –≤—ã—à–µ.</div>
    </div>`;
  document.getElementById('again').addEventListener('click',()=>location.reload());
  document.getElementById('export').addEventListener('click',()=>downloadCSV(JSON.parse(localStorage.getItem('quizLogs')||'[]')));
}

render();
</script>
</body>
</html>
